{"version":3,"file":"header.js","sources":["../../src/blocks/header/header.ts"],"sourcesContent":["import { getMetadata } from '../../utils/getMetadata.js';\nimport { loadFragment } from '../fragment/fragment.js';\nimport './header.scss';\n\n// media query match that indicates mobile/tablet width\nconst isDesktop = window.matchMedia('(min-width: 900px)');\n\n/**\n * Toggles all nav sections\n * @param {Element} sections The container element\n * @param {Boolean} expanded Whether the element should be expanded or collapsed\n */\nfunction toggleAllNavSections(sections, expanded = false) {\n  sections.querySelectorAll('.nav-sections .default-content-wrapper > ul > li').forEach((section) => {\n    section.setAttribute('aria-expanded', expanded);\n  });\n}\n\nfunction openOnKeydown(e) {\n  const focused = document.activeElement;\n  const isNavDrop = focused?.className === 'nav-drop';\n  if (isNavDrop && (e.code === 'Enter' || e.code === 'Space')) {\n    const dropExpanded = focused.getAttribute('aria-expanded') === 'true';\n    // eslint-disable-next-line no-use-before-define\n    toggleAllNavSections(focused.closest('.nav-sections'));\n    focused.setAttribute('aria-expanded', dropExpanded ? 'false' : 'true');\n  }\n}\n\nfunction focusNavSection() {\n  document.activeElement?.addEventListener('keydown', openOnKeydown);\n}\n\n/**\n * Toggles the entire nav\n * @param {Element} nav The container element\n * @param {Element} navSections The nav sections within the container element\n * @param {*} forceExpanded Optional param to force nav expand behavior when not null\n */\nfunction toggleMenu(nav, navSections, forceExpanded: boolean | null = null) {\n  const expanded = forceExpanded !== null ? !forceExpanded : nav.getAttribute('aria-expanded') === 'true';\n  const button = nav.querySelector('.nav-hamburger button') as HTMLButtonElement | null;\n  document.body.style.overflowY = expanded || isDesktop.matches ? '' : 'hidden';\n  nav.setAttribute('aria-expanded', expanded ? 'false' : 'true');\n  toggleAllNavSections(navSections, !(expanded || isDesktop.matches));\n  button?.setAttribute('aria-label', expanded ? 'Open navigation' : 'Close navigation');\n  // enable nav dropdown keyboard accessibility\n  const navDrops = navSections.querySelectorAll('.nav-drop') as HTMLElement[];\n  if (isDesktop.matches) {\n    navDrops.forEach((drop) => {\n      if (!drop.hasAttribute('tabindex')) {\n        drop.setAttribute('role', 'button');\n        drop.setAttribute('tabindex', '0');\n        drop.addEventListener('focus', focusNavSection);\n      }\n    });\n  } else {\n    navDrops.forEach((drop) => {\n      drop.removeAttribute('role');\n      drop.removeAttribute('tabindex');\n      drop.removeEventListener('focus', focusNavSection);\n    });\n  }\n  // enable menu collapse on escape keypress\n  if (!expanded || isDesktop.matches) {\n    // collapse menu on escape press\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    window.addEventListener('keydown', closeOnEscape);\n  } else {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    window.removeEventListener('keydown', closeOnEscape);\n  }\n}\n\nfunction closeOnEscape(e) {\n  if (e.code === 'Escape') {\n    const nav = document.getElementById('nav');\n    const navSections = nav?.querySelector('.nav-sections');\n    const navSectionExpanded = navSections?.querySelector<HTMLElement>('[aria-expanded=\"true\"]');\n    if (navSectionExpanded && isDesktop.matches) {\n      // eslint-disable-next-line no-use-before-define\n      toggleAllNavSections(navSections);\n      navSectionExpanded.focus();\n    } else if (!isDesktop.matches) {\n      // eslint-disable-next-line no-use-before-define\n      toggleMenu(nav, navSections);\n      nav?.querySelector('button')?.focus();\n    }\n  }\n}\n\n/**\n * loads and decorates the header, mainly the nav\n * @param {Element} block The header block element\n */\nexport default async function decorate(block) {\n  // load nav as fragment\n  const navMeta = getMetadata('nav');\n  const navPath = navMeta ? new URL(navMeta, window.location.origin).pathname : '/nav';\n  const fragment = await loadFragment(navPath);\n\n  // decorate nav DOM\n  block.textContent = '';\n  const nav = document.createElement('nav');\n  nav.id = 'nav';\n  if (fragment) {\n    while (fragment.firstElementChild) nav.append(fragment.firstElementChild);\n  }\n\n  const classes = ['brand', 'sections', 'tools'];\n  classes.forEach((c, i) => {\n    const section = nav.children[i];\n    if (section) section.classList.add(`nav-${c}`);\n  });\n\n  const navBrand = nav.querySelector('.nav-brand');\n  const brandLink = navBrand?.querySelector('.button');\n  if (brandLink) {\n    brandLink.className = '';\n    const closestElement = brandLink.closest('.button-container');\n    if (closestElement) closestElement.className = '';\n  }\n\n  const navSections = nav.querySelector('.nav-sections');\n  if (navSections) {\n    navSections.querySelectorAll(':scope .default-content-wrapper > ul > li').forEach((navSection) => {\n      if (navSection.querySelector('ul')) navSection.classList.add('nav-drop');\n      navSection.addEventListener('click', () => {\n        if (isDesktop.matches) {\n          const expanded = navSection.getAttribute('aria-expanded') === 'true';\n          toggleAllNavSections(navSections);\n          navSection.setAttribute('aria-expanded', expanded ? 'false' : 'true');\n        }\n      });\n    });\n  }\n\n  // hamburger for mobile\n  const hamburger = document.createElement('div');\n  hamburger.classList.add('nav-hamburger');\n  hamburger.innerHTML = `<button type=\"button\" aria-controls=\"nav\" aria-label=\"Open navigation\">\n      <span class=\"nav-hamburger-icon\"></span>\n    </button>`;\n  hamburger.addEventListener('click', () => toggleMenu(nav, navSections));\n  nav.prepend(hamburger);\n  nav.setAttribute('aria-expanded', 'false');\n  // prevent mobile nav behavior on window resize\n  toggleMenu(nav, navSections, isDesktop.matches);\n  isDesktop.addEventListener('change', () => toggleMenu(nav, navSections, isDesktop.matches));\n\n  const navWrapper = document.createElement('div');\n  navWrapper.className = 'nav-wrapper';\n  navWrapper.append(nav);\n  block.append(navWrapper);\n}\n"],"names":["isDesktop","toggleAllNavSections","sections","expanded","section","openOnKeydown","e","focused","dropExpanded","focusNavSection","_a","toggleMenu","nav","navSections","forceExpanded","button","navDrops","drop","closeOnEscape","navSectionExpanded","decorate","block","navMeta","getMetadata","navPath","fragment","loadFragment","c","i","navBrand","brandLink","closestElement","navSection","hamburger","navWrapper"],"mappings":"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"}